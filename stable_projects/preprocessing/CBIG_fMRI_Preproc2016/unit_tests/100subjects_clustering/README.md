This readme includes the steps about how to run the 17 networks clustering algorithm of Yeo et al., 2011 to check if your preprocessing results are fine. To run this clustering algorithm, you can use the preprocessed data which are mentioned below, or use the data of the same subjects but preprocessed by different pipelines(with the same or different configuration file).

Notice that all the filenames and directories below work for CBIG lab only. It is assumed that the input surface data are in `fsaverage5` space.

----

## Data

- Data set

The `CBIG_fMRI_Preproc2016` preprocessing scripts use the Brain Genomics Superstruct Project (GSP) data as a baseline data set. All data mentioned here are based on GSP data set.

GSP data contain both structual MRI (T1) and functional MRI (T2*). All subjects (N = 1570) are healthy, young subjects (age: 18-35). The preprocessed (by `recon-all`) structual MRI data and raw functional MRI are in this folder:

```
/mnt/eql/yeo1/data/GSP_release
```

where the folder names with `_FS` (e.g. `Sub0001_Ses1_FS`) meaning they are structual MRI data after `recon-all` processing, and the folder names without `_FS` (e.g. `Sub0001_Ses1`) meaning they are raw functional MRI data.

- Subject list

In total, 100 subjects were chosen to perform the clustering algorithm. To choose the 100 subjects, all GSP subjects (in total 1482 subjects after a preprocessing pipeline configured by `/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/scripts/prepro.config`) were sorted by their mean framewise displacement from low to high. The first 80 subjects were selected, and the residual 20 subjects were picked after the 600-th one so that the 100 subjects are a mixture of low-motion and high-motion subjects. The subject list is:

```
$CBIG_CODE_DIR/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/unit_tests/100subjects_clustering/GSP_80_low_motion+20_w_censor.txt
```

- Preprocessed data

The clustering results mentioned in this readme are based on the preprocessed fMRI data in this folder:

```
/mnt/eql/yeo1/CBIG_private_data/replication/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/100subjects_clustering/preproc_out
```

by the following script and config file:
```
$CBIG_CODE_DIR/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/unit_tests/100subjects_clustering/CBIG_preproc_unit_tests_preprocess_100subjects.csh
$CBIG_CODE_DIR/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/unit_tests/100subjects_clustering/prepro.config
```

----

## Code

The clustering results mentioned here are generated by using this command

```
$CBIG_CODE_DIR/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/unit_tests/100subjects_clustering/CBIG_preproc_unit_tests_general_cluster_GSP_80_low_motion+20_w_censor.csh <your_output_dir> <your_preprocessed_subjects_dir>
```

where <your_output_dir> will store all outputs generated by the clustering scripts, and <your_preprocessed_subjects_dir> contains the 100 GSP subjects preprocessed by you. This command will take ~15h and 2GB to run.


----

## Results

- The 17 network clustering result of the 100 subjects is:

```
/mnt/eql/yeo1/CBIG_private_data/replication/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/100subjects_clustering/clustering/GSP_80_low_mt_20_w_censor_clusters017_scrub.mat
```

- To compare this clustering result with your own result, use the following function in matlab:

```
cd([getenv('CBIG_CODE_DIR') '/stable_projects/preprocessing/CBIG_fMRI_Preproc2016/unit_tests/100subjects_clustering'])
CBIG_preproc_unit_tests_cmp_clusters( <your_cluster_result_mat>, <comparison_dir> )
```

A message "Clustering result was replicated." means you have successfully replicated the ground truth.

You can visually check your clustering result from this figure:

```
<comparison_dir>/your_clusters017_scrub.png
```

----

## References

- Yeo, BT Thomas, et al. "The organization of the human cerebral cortex estimated by intrinsic functional connectivity." Journal of neurophysiology 106.3 (2011): 1125-1165.

- Holmes, Avram J., et al. "Brain Genomics Superstruct Project initial data release with structural, functional, and behavioral measures." Scientific data 2 (2015).
